{% extends 'layout.html' %}
{% set active_page = "profile" %}
{% block title %}
<title> | </title>
{% endblock %}
{% block content %}
    <div class="profile-content text-warning">
        <h2 class="border-bottom pb-2 mb-4">{{ title }} - {{ current_user.name }}</h2>
        <p><span class='field-title'>Institute: </span>
        {% if session.get('user_type') == 'admin' %}
        {{ current_user.institute }}
        {% else %}
        {{ current_user.institute.institute }}</p>
        {% endif %}
        <p><span class="field-title">Role: </span>
        {{ session.get('user_type') }} </p>
        {% if session.get(user_type) == 'librarian' %}
        <p><span class='field-title'>Join Date:</span>
        {{ current_user.join_date }}</p>
        {%  elif session.get(user_type) == 'borrower' %}
        <p><span class='field-title'>Dept: </span>
        {{ current_user.dept.name }}</p>
        <p><span class='field-title'>Fine due: </span>
        {{ current_user.fine_due }}</p>
        {% endif %}
        <p class="d-sm-inline-block">
          <span class="field-title">Username: </span> 
          {{ current_user.username }}
        </p>
        <a href='#chng-uname' class="profile-link" data-toggle="collapse">Change username?</a>
        <div id='chng-uname' class="collapse hidden-layout rounded">
            <form action="{{ url_for('chng_uname') }}" method="POST" id="hello">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{form.cur_password.label(class="form-control-label")}}
                    {% if form.cur_password.errors %}
                        {{form.cur_password(class="form-control form-control-lg is-invalid")}}
                        <div class="invalid-feedback">
                            {%for error in form.cur_password.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{form.cur_password(class="form-control form-control-lg")}}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{form.new_username.label(class="form-control-label")}}
                    {% if form.new_username.errors %}
                        {{form.new_username(class="form-control form-control-lg is-invalid")}}
                        <div class="invalid-feedback">
                        {%for error in form.new_username.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                        </div>
                    {% else %}
                        {{form.new_username(class="form-control form-control-lg")}}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{form.save_changes(class="btn btn-outline-warning")}}
                </div>
            </form>
        </div>
        <br>
        <p class="d-sm-inline-block">
          <span class="field-title">Email ID: </span>
          {{ current_user.email }} 
        </p>
        <a href='#chng-mail' class="profile-link" data-toggle="collapse">Change email?</a>
        <div id='chng-mail' class="collapse hidden-layout rounded">
            <form action="" method="POST">
              {{ form.hidden_tag() }}
              <div class="form-group">
                {{form.cur_password.label(class="form-control-label")}}
                {% if form.cur_password.errors %}
                    {{form.cur_password(class="form-control form-control-lg is-invalid")}}
                    <div class="invalid-feedback">
                        {%for error in form.cur_password.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{form.cur_password(class="form-control form-control-lg")}}
                {% endif %}
              </div>
              <div class="form-group">
                {{form.new_email.label(class="form-control-label")}}
                {% if form.new_email.errors %}
                    {{form.new_email(class="form-control form-control-lg is-invalid")}}
                    <div class="invalid-feedback">
                        {%for error in form.new_email.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{form.new_email(class="form-control form-control-lg")}}
                {% endif %}
            </div>
            <div class="form-group">
              {{form.save_changes(class="btn btn-outline-warning")}}
            </div>
          </form>
        </div>
        <br>
        <p class="d-sm-inline-block">Password: ***** ALL</p>
        <a href="#chng-pw" class="profile-link" data-toggle="collapse">Change pw?</a>
        <div id='chng-pw' class="collapse hidden-layout rounded">
            <form action="" method="POST" id='helo'>
              {{ form.hidden_tag() }}
              <div class="form-group">
                {{form.cur_password.label(class="form-control-label")}}
                {{form.id}}
                {% if form.cur_password.errors %}
                    {{form.cur_password(class="form-control form-control-lg is-invalid")}}
                    <div class="invalid-feedback">
                        {%for error in form.cur_password.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{form.cur_password(class="form-control form-control-lg")}}
                {% endif %}
              </div>
              <div class="form-group">
                {{form.new_password.label(class="form-control-label")}}
                {% if form.new_password.errors %}
                    {{form.new_password(class="form-control form-control-lg is-invalid")}}
                    <div class="invalid-feedback">
                        {%for error in form.new_password.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{form.new_password(class="form-control form-control-lg")}}
                {% endif %}
              </div>
              <div class="form-group">
                {{form.confirm_password.label(class="form-control-label")}}
                {% if form.confirm_password.errors %}
                    {{form.confirm_password(class="form-control form-control-lg is-invalid")}}
                    <div class="invalid-feedback">
                        {%for error in form.confirm_password.errors %}
                            <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                {% else %}
                    {{form.confirm_password(class="form-control form-control-lg")}}
                {% endif %}
              </div>
              <div class="form-group">
                {{form.save_changes(class="btn btn-outline-warning")}}
              </div>
            </form>
        </div>
    </div>
    
{% endblock %}